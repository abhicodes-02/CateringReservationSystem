<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Available Products</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background-color: #f4f4f4;
      padding: 20px;
    }

    h2 {
      text-align: center;
      color: #007BFF;
      margin-bottom: 20px;
    }

    #products {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      justify-content: center;
    }

    .product-card {
      background: white;
      padding: 15px;
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      width: 250px;
      text-align: center;
      transition: transform 0.2s;
    }

    .product-card:hover {
      transform: scale(1.03);
    }

    .product-image {
      width: 100%;
      height: 150px;
      object-fit: cover;
      border-radius: 8px;
      margin-bottom: 10px;
    }

    .product-name {
      font-size: 1.2em;
      font-weight: bold;
      margin-bottom: 5px;
    }

    .product-price input {
      width: 80%;
      padding: 5px;
      font-size: 1em;
      margin-bottom: 5px;
    }

    .uploaded-by {
      font-size: 0.8em;
      color: gray;
    }

    .update-btn {
      background-color: #28a745;
      color: white;
      border: none;
      padding: 6px 10px;
      border-radius: 5px;
      cursor: pointer;
      margin-top: 5px;
    }

    .update-btn:hover {
      background-color: #218838;
    }

    .back-button {
      display: block;
      text-align: center;
      margin-top: 30px;
      text-decoration: none;
      color: #007BFF;
      font-weight: bold;
    }

    .back-button:hover {
      text-decoration: underline;
    }

    @media (max-width: 600px) {
      .product-card {
        width: 90%;
      }
    }
  </style>
</head>
<body>

  <h2>Available Products</h2>
  <div id="products">Loading products...</div>

  <a class="back-button" href="dashboard.html">‚Üê Back to Dashboard</a>

  <script type="module">
    import { db } from './script/firebase-config.js';
    import {
      collection,
      getDocs,
      doc,
      updateDoc
    } from 'https://www.gstatic.com/firebasejs/10.0.0/firebase-firestore.js';

    const container = document.getElementById("products");

    // ‚úÖ Fetch food image from Unsplash
    async function fetchUnsplashImage(query) {
  const accessKey = "RuGyciVT_8MU1vh6oO2lOPbmce30Vp1cXPdzF8rEnRc";
  const apiUrl = `https://api.unsplash.com/search/photos?query=${encodeURIComponent(query + " food")}&client_id=${accessKey}&per_page=1`;

  try {
    const response = await fetch(apiUrl);
    const data = await response.json();

    if (data.results && data.results.length > 0) {
      return data.results[0].urls.small;
    } else {
      return "https://via.placeholder.com/250x150?text=No+Image";
    }
  } catch (error) {
    console.error("Error fetching from Unsplash:", error);
    return "https://via.placeholder.com/250x150?text=Error";
  }
}


    async function viewStyledProducts() {
      try {
        const snapshot = await getDocs(collection(db, "products"));
        container.innerHTML = "";

        if (snapshot.empty) {
          container.innerHTML = "<p>No products available.</p>";
        } else {
          for (const docSnap of snapshot.docs) {
            const data = docSnap.data();
            const id = docSnap.id;
            const imageUrl = await fetchUnsplashImage(data.name || "food");

            const card = document.createElement("div");
            card.className = "product-card";
            card.innerHTML = `
              <img class="product-image" src="${imageUrl}" alt="${data.name}">
              <div class="product-name">${data.name || "Unnamed"}</div>
              <div class="product-price">
                ‚Çπ<input type="number" value="${data.price || 0}" id="price-${id}">
              </div>
              <div class="uploaded-by">By: ${data.uploadedBy || "Unknown"}</div>
              <button class="update-btn" onclick="updatePrice('${id}')">Update Price</button>
            `;
            container.appendChild(card);
          }
        }
      } catch (err) {
        container.innerHTML = `<p>Error loading products: ${err.message}</p>`;
      }
    }

    // üîÑ Update price in Firebase
    window.updatePrice = async function(id) {
      const input = document.getElementById(`price-${id}`);
      const newPrice = parseFloat(input.value);

      if (isNaN(newPrice) || newPrice <= 0) {
        alert("Please enter a valid price.");
        return;
      }

      try {
        await updateDoc(doc(db, "products", id), {
          price: newPrice
        });
        alert("Price updated successfully!");
      } catch (error) {
        alert("Error updating price: " + error.message);
      }
    }

    viewStyledProducts();
  </script>

</body>
</html>
